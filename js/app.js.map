{"version":3,"sources":["artists.js","database.js","elements.js","file-transfer.js","filter.js","generator.js","lottery.js","modal.js","names.js","scheduler.js","screen.js","system-actions.js","time.js","main.js","tab-enter.js"],"names":["scope","Artists","addLottery","appendToday","clear","clearArtists","delete","deleteArtistById","get","getArtistById","getAll","getAllArtists","set","setArtist","setAll","setAllArtists","setSeated","setStandby","setSignedOut","ARTISTS_TABLE_NAME","getDatabase","Database","addArrayEntry","arrayData","elementToAdd","Array","isArray","indexOf","concat","slice","getMaxFieldValue","artists","fieldName","Math","max","apply","map","a","arr","getTodayString","Time","getArtistFromArray","id","find","artist","tableNumber","then","seatedDays","seatedLast","moment","format","standbyOrder","lotteryOrder","roomNumber","standbyDays","eligible","lotteryEligible","open","incrementTableVersion","toArray","database","transaction","forEach","isNew","data","Object","assign","put","update","window","exports","db","backup","backupDatabase","deleteDatabase","getSchema","getTableVersion","initialize","restore","restoreDatabase","select","selectDatabase","performTransaction","TABLE_VERSIONS_NAME","_inTransactionScope","_databaseName","dexie","Dexie","version","stores","join","tableVersions","catch","handleError","Promise","on","tableName","schema","error","err","Error","errorMessage","stack","console","callback","tables","table","name","result","versions","output","all","resolve","toLowerCase","rows","tableRows","row","push","keys","log","clearTask","databaseName","close","Elements","buildIcon","buildSpan","buildSymbols","iconName","$","addClass","className","symbolElement","standbyFlag","length","append","attr","docScope","FileTransfer","download","upload","fileName","text","anchor","createElement","href","URL","createObjectURL","Blob","type","body","appendChild","click","removeChild","file","reject","reader","FileReader","onload","response","target","onerror","readAsText","document","Filter","checkedOutToday","lottery","lotteryGuaranteed","lotteryInOrder","seated","seatedInOrder","sorted","sortArtistsByName","standby","standbyInOrder","todayString","filter","filterArtists","filterAndSortArtists","sortArtistsNumerically","filterField","sortField","sortArtists","sort","b","fieldA","fieldB","toLocaleLowerCase","Generator","getRandomArtist","random","badgeNumber","phone","randomOf","randomPhone","remarks","randomBool","floor","choices","separator","countryCode","Lottery","reset","resetSeating","run","runLottery","shuffleArtists","count","i","randomIndex","temp","slotsAvailable","allArtists","eligibleArtists","lotteryNumber","standbyNumber","Modal","addArtist","alert","showAlert","batchSignOut","bulkArtistRoom","confirm","showConfirm","confirmConfirm","editArtist","editArtistRaw","prompt","showPrompt","promptConfirm","resetDatabase","seedDatabase","setRawArtistId","showCheckedOutArtists","showYesNoCancel","_promptConfirm","_rapidEntry","registerConfirm","handler","value","pop","val","mapArtistData","artistData","html","prop","calendar","configureArtistDetail","isAddingArtist","show","hide","rapidEntry","doNotOpenModal","modal","container","nameField","tableField","inputBox","last","keydown","e","which","preventDefault","setTimeout","focus","each","div","hasClass","slimScroll","height","replaceWith","clone","some","selectedId","editor","JSON","stringify","message","caption","backdrop","names","elements","getArtistFormId","Number","saveEditedArtist","saveEditedRooms","artistRooms","inputElement","artistId","toggleArtistModal","trigger","first","confirmed","trim","performAction","index","seat","change","selectOption","Names","populate","allListByName","standbyList","seatedList","lotteryList","lotteryListByName","checkedOutList","buildNames","withSymbols","withOrder","disableClick","buildNameOptions","nameData","tempContainer","options","empty","nameElement","prepend","tableElement","createNameDetailClickHandler","openNameDetail","Scheduler","onArtistChange","artistChangeEvents","artistTableVersion","isDatabaseBusy","setInterval","onTick","invokeAll","events","eventFunction","Screen","reposition","width","leftMargin","containerWidth","css","screenId","desiredScreen","remove","content","size","alwaysVisible","SystemActions","databaseBackup","databaseRestore","exportCsv","findArtistByBadge","findArtistByTable","findCheckedOutArtists","newArtistRapidEntry","saveArtistRaw","confirmAction","actionName","excelMode","users","csv","csvColumns","user","csvRow","column","columnValue","replace","findArtist","predicate","filteredArtists","findArtistBy","valueString","seats","parse","files","fileData","jsonData","InitializeFirstScreen","location","hash","substring","InitializeResizeHandler","resize","InitializeModalNavigation","linkElement","modalId","InitializeScreenNavigation","InitializeSystemActions","action","appendTo","setModalsAndBackdropsOrder","removeClass","modalZIndex","backdropZIndex","JoelPurra","PlusAsTab","setOptions","key"],"mappings":"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","file":"app.js","sourcesContent":["/* globals exports */\r\n\r\n(function(scope) {\r\n  // Interface.\r\n  scope.Artists = {\r\n    addLottery: addLottery,\r\n    appendToday: appendToday,\r\n    clear: clearArtists,\r\n    delete: deleteArtistById,\r\n    get: getArtistById,\r\n    getAll: getAllArtists,\r\n    set: setArtist,\r\n    setAll: setAllArtists,\r\n    setSeated: setSeated,\r\n    setStandby: setStandby,\r\n    setSignedOut: setSignedOut\r\n  };\r\n\r\n  // Constants.\r\n  var ARTISTS_TABLE_NAME = 'artists';\r\n\r\n  function getDatabase() {\r\n    return scope.Database;\r\n  }\r\n\r\n  // Return a copy of the array with the element added, without duplications.\r\n  function addArrayEntry(arrayData, elementToAdd) {\r\n    if (Array.isArray(arrayData)) {\r\n      if (arrayData.indexOf(elementToAdd) < 0) {\r\n        return arrayData.concat(elementToAdd);\r\n      }\r\n      return arrayData.slice();\r\n    }\r\n    return [elementToAdd];\r\n  }\r\n\r\n  // Get the maximum value for a field name.\r\n  function getMaxFieldValue(artists, fieldName) {\r\n    return Math.max.apply(0, artists.map(function(a) {\r\n      return a[fieldName] || 0;\r\n    }));\r\n  }\r\n\r\n  // Get a copy of the array with today's day string added.\r\n  function appendToday(arr) {\r\n    return addArrayEntry(arr, getTodayString());\r\n  }\r\n\r\n  // Get today's day string.\r\n  function getTodayString() {\r\n    return scope.Time.getTodayString();\r\n  }\r\n\r\n  // Get an artist by ID from a collection.\r\n  function getArtistFromArray(artists, id) {\r\n    return artists.find(function(artist) {\r\n        return artist.id === id;\r\n      }) || {\r\n        id: id\r\n      };\r\n  }\r\n\r\n  // Set an artist's status to seated, with the specified table number.\r\n  function setSeated(id, tableNumber) {\r\n    return getArtistById(id).then(\r\n      function(artist) {\r\n        return setArtist({\r\n          id: id,\r\n          tableNumber: tableNumber,\r\n          seatedDays: appendToday(artist.seatedDays),\r\n          seatedLast: moment().format(),\r\n          standbyOrder: null,\r\n          lotteryOrder: null\r\n        });\r\n      });\r\n  }\r\n\r\n  // Add an artist to the end of the standby list.\r\n  function setStandby(id) {\r\n    return getAllArtists().then(\r\n      function(artists) {\r\n        return setArtist({\r\n          id: id,\r\n          standbyOrder: getMaxFieldValue(artists, 'standbyOrder') + 1,\r\n          lotteryOrder: null,\r\n          tableNumber: null,\r\n          roomNumber: null,\r\n          standbyDays: appendToday(getArtistFromArray(artists, id).standbyDays)\r\n        });\r\n      });\r\n  }\r\n\r\n  // Set an artist to signed out.\r\n  function setSignedOut(id, eligible) {\r\n    return setArtist({\r\n      id: id,\r\n      tableNumber: null,\r\n      lotteryOrder: null,\r\n      standbyOrder: null,\r\n      lotteryEligible: eligible,\r\n      roomNumber: null\r\n    });\r\n  }\r\n\r\n  // Add an artist to the end of the lottery list.\r\n  function addLottery(id) {\r\n    return getAllArtists().then(\r\n      function(artists) {\r\n        return setArtist({\r\n          id: id,\r\n          lotteryOrder: getMaxFieldValue(artists, 'lotteryOrder') + 1,\r\n          standbyOrder: null,\r\n          tableNumber: null,\r\n          roomNumber: null\r\n        });\r\n      });\r\n  }\r\n\r\n  // Clear all artists from the database.\r\n  function clearArtists() {\r\n    return getDatabase().open().artists.clear()\r\n      .then(incrementTableVersion);\r\n  }\r\n\r\n  // Delete an artist from the database by ID.\r\n  function deleteArtistById(id) {\r\n    return getDatabase().open().artists.delete(+id)\r\n      .then(incrementTableVersion);\r\n  }\r\n\r\n  // Get all artists.\r\n  function getAllArtists() {\r\n    return getDatabase().open().artists.toArray();\r\n  }\r\n\r\n  // Get an artist by ID.\r\n  function getArtistById(id) {\r\n    return getDatabase().open().artists.get(+id);\r\n  }\r\n\r\n  // Set multiple artist data.\r\n  function setAllArtists(artists) {\r\n    var database = getDatabase();\r\n    return database.transaction(function() {\r\n      artists.forEach(function(artist) {\r\n        var isNew = !artist.id;\r\n        var data = Object.assign({}, artist);\r\n        delete data.id;\r\n        if (isNew) {\r\n          database.open().artists.put(data);\r\n        } else {\r\n          database.open().artists.update(+artist.id, data);\r\n        }\r\n      });\r\n      incrementTableVersion();\r\n    });\r\n  }\r\n\r\n  // Set an artist's data. If the ID doesn't exist, a new record is made.\r\n  function setArtist(artist) {\r\n    return setAllArtists([artist]);\r\n  }\r\n\r\n  // Indicate that the table has changed.\r\n  function incrementTableVersion() {\r\n    return getDatabase().incrementTableVersion(ARTISTS_TABLE_NAME);\r\n  }\r\n})((typeof window !== 'undefined') ? window : exports);\r\n","/* globals exports, Promise */\r\n\r\n(function(scope) {\r\n  var db;\r\n\r\n  // Interface.\r\n  scope.Database = {\r\n    backup: backupDatabase,\r\n    delete: deleteDatabase,\r\n    getSchema: getSchema,\r\n    getTableVersion: getTableVersion,\r\n    incrementTableVersion: incrementTableVersion,\r\n    open: initialize,\r\n    restore: restoreDatabase,\r\n    select: selectDatabase,\r\n    transaction: performTransaction\r\n  };\r\n\r\n  // Constants.\r\n  var TABLE_VERSIONS_NAME = 'tableversions';\r\n\r\n  // If true, we're already in a transaction scope.\r\n  var _inTransactionScope = false;\r\n  var _databaseName = 'ArtTrackPlus2';\r\n\r\n  // (Lazily) initialize Dexie.\r\n  function initialize() {\r\n    if (!db) {\r\n      var dexie = new Dexie(_databaseName);\r\n      dexie.version(1)\r\n        .stores({\r\n          artists: [\r\n            '++id',\r\n            'name',\r\n            'badgeNumber',\r\n            'tableNumber',\r\n            'roomNumber',\r\n            'phone',\r\n            'remarks',\r\n            'lotteryEligible',\r\n            'lotteryGuaranteed',\r\n            'lotteryOrder',\r\n            'seatedLast',\r\n            'seatedDays',\r\n            'standbyDays',\r\n            'standbyOrder'\r\n          ].join(),\r\n          tableVersions: [\r\n            '++id',\r\n            'artists'\r\n          ].join()\r\n        });\r\n      dexie.open().catch(handleError);\r\n      Dexie.Promise.on('error', handleError);\r\n\r\n      db = dexie;\r\n    }\r\n\r\n    return db;\r\n  }\r\n\r\n  // Get the schema for a table.\r\n  function getSchema(tableName) {\r\n    return initialize()[tableName].schema;\r\n  }\r\n\r\n  // Error handler for Dexie.\r\n  function handleError(error) {\r\n    var err = new Error();\r\n    var errorMessage = 'Dexie has encountered an error: ' + error + '\\n\\n' +\r\n      err.stack;\r\n    console.error(errorMessage);\r\n  }\r\n\r\n  // Delete database.\r\n  function deleteDatabase() {\r\n    var database = initialize();\r\n    db = null;\r\n    return database.delete();\r\n  }\r\n\r\n  // Perform a database transaction.\r\n  function performTransaction(callback) {\r\n    var database = initialize();\r\n    if (_inTransactionScope) {\r\n      return callback();\r\n    } else {\r\n      return database.transaction('rw', database.tables.map(function(table) {\r\n        return table.name;\r\n      }), function() {\r\n        _inTransactionScope = true;\r\n        var result = callback();\r\n        _inTransactionScope = false;\r\n        return result;\r\n      });\r\n    }\r\n  }\r\n\r\n  // Get current table version.\r\n  function getTableVersion() {\r\n    return initialize().tableVersions.get(1);\r\n  }\r\n\r\n  // Increment table version.\r\n  function incrementTableVersion(tableName) {\r\n    return getTableVersion(tableName).then(function(versions) {\r\n      if (!versions) {\r\n        versions = {\r\n          id: 1\r\n        };\r\n      }\r\n      if (!versions[tableName]) {\r\n        versions[tableName] = 0;\r\n      }\r\n      versions[tableName]++;\r\n      return initialize().tableVersions.put(versions);\r\n    });\r\n  }\r\n\r\n  // Back up the database\r\n  function backupDatabase() {\r\n    var output = {};\r\n    var tables = initialize().tables;\r\n\r\n    return Promise.all(tables.map(function(table) {\r\n      return new Promise(function(resolve) {\r\n        if (table.name.toLowerCase() === TABLE_VERSIONS_NAME) {\r\n          resolve();\r\n          return;\r\n        }\r\n        table.toArray(function(rows) {\r\n          var tableRows = [];\r\n          rows.forEach(function(row) {\r\n            tableRows.push(row);\r\n          });\r\n          output[table.name] = tableRows;\r\n          resolve();\r\n        });\r\n      });\r\n    })).then(function() {\r\n      return Promise.resolve(output);\r\n    });\r\n  }\r\n\r\n  // Restore the database\r\n  function restoreDatabase(tables) {\r\n    return Promise.all(Object.keys(tables).map(function(tableName) {\r\n      if (tableName.toLowerCase() !== TABLE_VERSIONS_NAME) {\r\n        var table = initialize()[tableName];\r\n        console.log('clear table ' + tableName);\r\n        var clearTask = table.clear ? table.clear() : Promise.resolve();\r\n        return clearTask.then(function() {\r\n          var rows = tables[tableName];\r\n          Promise.all(rows.map(function(row) {\r\n            return table.put(row);\r\n          }));\r\n          return incrementTableVersion(tableName);\r\n        });\r\n      }\r\n    }));\r\n  }\r\n\r\n  function selectDatabase(databaseName) {\r\n    _databaseName = databaseName;\r\n    if (db) {\r\n      db.close();\r\n      db = null;\r\n    }\r\n  }\r\n\r\n})((typeof window !== 'undefined') ? window : exports);\r\n","(function(scope) {\r\n  // Interface.\r\n  scope.Elements = {\r\n    buildIcon: buildIcon,\r\n    buildSpan: buildSpan,\r\n    buildSymbols: buildSymbols\r\n  };\r\n\r\n  // Create an icon to go on the name list.\r\n  function buildIcon(iconName) {\r\n    return $('<i/>')\r\n      .addClass('fa fa-' + iconName);\r\n  }\r\n\r\n  // Create a span element with the specified class.\r\n  function buildSpan(className) {\r\n    return $('<span/>')\r\n      .addClass(className);\r\n  }\r\n\r\n  // Build Font Awesome symbols.\r\n  function buildSymbols(artist) {\r\n    var symbolElement = buildSpan('artist-symbols');\r\n\r\n    var standbyFlag = !artist.seatedLast &&\r\n      (artist.standbyDays && artist.standbyDays.length >= 2);\r\n\r\n    if (artist.lotteryOrder > 0) {\r\n      symbolElement.append(buildIcon('check').attr('title', 'Picked For Lottery'));\r\n    }\r\n\r\n    if (artist.standbyOrder > 0) {\r\n      symbolElement.append(buildIcon('clock-o').attr('title', 'On Standby'));\r\n    }\r\n\r\n    if (artist.tableNumber) {\r\n      symbolElement.append(buildIcon('sign-in').attr('title', 'Signed In'));\r\n    }\r\n\r\n    if (standbyFlag) {\r\n      symbolElement.append(buildIcon('exclamation attention').attr('title', 'This artist has been on standby for at least two days.'));\r\n    }\r\n\r\n    return symbolElement;\r\n  }\r\n})(window);\r\n","/* globals Promise */\r\n\r\n(function(scope, docScope) {\r\n  scope.FileTransfer = {\r\n    download: download,\r\n    upload: upload\r\n  };\r\n\r\n  // Send file contents to a user.\r\n  function download(fileName, text) {\r\n    return new Promise(function(resolve) {\r\n      var anchor = docScope.createElement('a');\r\n      anchor.href = scope.URL.createObjectURL(new Blob([text], {\r\n        type: 'text/csv'\r\n      }));\r\n      anchor.download = fileName;\r\n      docScope.body.appendChild(anchor);\r\n      anchor.click();\r\n      docScope.body.removeChild(anchor);\r\n      resolve();\r\n    });\r\n  }\r\n\r\n  // Retrieve file contents from a user.\r\n  function upload(file) {\r\n    return new Promise(function(resolve, reject) {\r\n      var reader = new FileReader();\r\n      reader.onload = function(response) {\r\n        resolve(response.target.result);\r\n      };\r\n      reader.onerror = function(error) {\r\n        reject(error);\r\n      };\r\n      reader.readAsText(file);\r\n    });\r\n  }\r\n\r\n})(window, document);\r\n","/* globals exports */\r\n\r\n(function(scope) {\r\n\r\n  // Interface.\r\n  scope.Filter = {\r\n    checkedOutToday: checkedOutToday,\r\n    lottery: lottery,\r\n    lotteryEligible: lotteryEligible,\r\n    lotteryGuaranteed: lotteryGuaranteed,\r\n    lotteryInOrder: lotteryInOrder,\r\n    seated: seated,\r\n    seatedInOrder: seatedInOrder,\r\n    sorted: sortArtistsByName,\r\n    standby: standby,\r\n    standbyInOrder: standbyInOrder\r\n  };\r\n\r\n  // Filter artists that have checked out today.\r\n  function checkedOutToday(artists) {\r\n    var todayString = scope.Time.getTodayString();\r\n    return artists.filter(function(a) {\r\n      return !!a.seatedDays &&\r\n        !a.tableNumber &&\r\n        a.seatedDays.indexOf(todayString) >= 0;\r\n    });\r\n  }\r\n\r\n  // Filter artists that are in the lottery, then return them in ABC order.\r\n  function lottery(artists) {\r\n    return sortArtistsByName(filterArtists(artists, 'lotteryOrder'));\r\n  }\r\n\r\n  // Filter artists that are eligible for lottery pick.\r\n  function lotteryEligible(artists) {\r\n    return filterArtists(artists, 'lotteryEligible');\r\n  }\r\n\r\n  // Filter artists that are guaranteed for lottery pick.\r\n  function lotteryGuaranteed(artists) {\r\n    return filterArtists(artists, 'lotteryGuaranteed');\r\n  }\r\n\r\n  // Filter artists that are in the lottery, then return them in lottery order.\r\n  function lotteryInOrder(artists) {\r\n    return filterAndSortArtists(artists, 'lotteryOrder');\r\n  }\r\n\r\n  // Filter artists that are seated, then return them in ABC order.\r\n  function seated(artists) {\r\n    return sortArtistsByName(filterArtists(artists, 'tableNumber'));\r\n  }\r\n\r\n  // Filter artists that are seated, then return them in table number order.\r\n  function seatedInOrder(artists) {\r\n    return sortArtistsNumerically(filterArtists(artists, 'tableNumber'), 'tableNumber');\r\n  }\r\n\r\n  // Filter artists that are on standby, then return them in ABC order.\r\n  function standby(artists) {\r\n    return sortArtistsByName(filterArtists(artists, 'standbyOrder'));\r\n  }\r\n\r\n  // Filter artists that are on standby, then return them in table number order.\r\n  function standbyInOrder(artists) {\r\n    return filterAndSortArtists(artists, 'standbyOrder');\r\n  }\r\n\r\n  // Filter and sort an artist list.\r\n  function filterAndSortArtists(artists, filterField, sortField) {\r\n    return sortArtists(filterArtists(artists, filterField),\r\n      sortField || filterField);\r\n  }\r\n\r\n  // Filter an artist list for values that are at all present.\r\n  function filterArtists(artists, filterField) {\r\n    return artists.filter(function(a) {\r\n      return !!a[filterField];\r\n    });\r\n  }\r\n\r\n  // Sort an artist list.\r\n  function sortArtists(artists, sortField) {\r\n    return artists.slice().sort(function(a, b) {\r\n      var fieldA = a[sortField];\r\n      var fieldB = b[sortField];\r\n      return fieldA > fieldB ? 1 : (fieldA < fieldB ? -1 : 0);\r\n    });\r\n  }\r\n\r\n  // Sort an artist list, with numeric values.\r\n  function sortArtistsNumerically(artists, sortField) {\r\n    return artists.slice().sort(function(a, b) {\r\n      var fieldA = +a[sortField];\r\n      var fieldB = +b[sortField];\r\n      return fieldA > fieldB ? 1 : (fieldA < fieldB ? -1 : 0);\r\n    });\r\n  }\r\n\r\n  // Sort names without case sensitivity.\r\n  function sortArtistsByName(artists) {\r\n    return artists.slice().sort(function(a, b) {\r\n      var fieldA = (a.name || '').toLocaleLowerCase();\r\n      var fieldB = (b.name || '').toLocaleLowerCase();\r\n      return fieldA > fieldB ? 1 : (fieldA < fieldB ? -1 : 0);\r\n    });\r\n  }\r\n})((typeof window !== 'undefined') ? window : exports);\r\n","/* globals exports */\r\n\r\n(function(scope) {\r\n\r\n  // Interface.\r\n  scope.Generator = {\r\n    getRandomArtist: getRandomArtist\r\n  };\r\n\r\n  // Generate random artist data.\r\n  function getRandomArtist() {\r\n    var artist = {\r\n      name: 'Test ' + (random(9000) + 1000),\r\n      badgeNumber: random(10000) + 1,\r\n      phone: randomOf([null, randomPhone()]),\r\n      remarks: randomOf([null, 'Etc Whatever']),\r\n      lotteryEligible: randomBool(),\r\n    };\r\n\r\n    return artist;\r\n  }\r\n\r\n  // Generate a random integer up to (but not including) the max value.\r\n  function random(max) {\r\n    return Math.floor(Math.random() * max);\r\n  }\r\n\r\n  // Select a random value from an array of values.\r\n  function randomOf(choices) {\r\n    return choices[random(choices.length)];\r\n  }\r\n\r\n  // Generate a random boolean value.\r\n  function randomBool() {\r\n    return Math.random() >= 0.5;\r\n  }\r\n\r\n  // Generate a random US phone number.\r\n  function randomPhone() {\r\n    var separator = randomOf(['.', '-', '']);\r\n    var countryCode = randomOf(['', '1' + separator]);\r\n    return countryCode +\r\n      (random(800) + 200) + separator +\r\n      (random(800) + 200) + separator +\r\n      (random(9000) + 1000);\r\n  }\r\n\r\n})((typeof window !== 'undefined') ? window : exports);\r\n","/* globals Artists, exports, Filter */\r\n\r\n(function(scope) {\r\n\r\n  // Interface.\r\n  scope.Lottery = {\r\n    reset: resetSeating,\r\n    run: runLottery\r\n  };\r\n\r\n  // Clear existing artist lottery/seated data.\r\n  function resetSeating(artists) {\r\n    artists.forEach(function(a) {\r\n      a.lotteryOrder = null;\r\n      a.standbyOrder = null;\r\n      a.tableNumber = null;\r\n    });\r\n  }\r\n\r\n  // Shuffle artists.\r\n  function shuffleArtists(artists) {\r\n    var count = artists.length;\r\n    artists.forEach(function(a, i) {\r\n      var randomIndex = Math.floor(Math.random() * count);\r\n      var temp = artists[i];\r\n      artists[i] = artists[randomIndex];\r\n      artists[randomIndex] = temp;\r\n    });\r\n  }\r\n\r\n  // Run the lottery for the specified number of slots available.\r\n  function runLottery(slotsAvailable) {\r\n    Artists.getAll().then(function(allArtists) {\r\n      // Initialization.\r\n      var eligibleArtists = Filter.lotteryEligible(allArtists);\r\n\r\n      resetSeating(allArtists);\r\n      shuffleArtists(eligibleArtists);\r\n\r\n      // Populate the guaranteed artists first.\r\n      var lotteryNumber = 1;\r\n      eligibleArtists.forEach(function(a) {\r\n        if (slotsAvailable > 0 && a.lotteryGuaranteed) {\r\n          a.lotteryOrder = lotteryNumber++;\r\n          slotsAvailable--;\r\n        }\r\n      });\r\n\r\n      // Fill up the remaining slots. If no further slots are\r\n      // avaialble, assign standby order.\r\n      var standbyNumber = 1;\r\n      eligibleArtists.forEach(function(a) {\r\n        if (!a.lotteryOrder) {\r\n          if (slotsAvailable > 0) {\r\n            a.lotteryOrder = lotteryNumber++;\r\n            slotsAvailable--;\r\n          } else {\r\n            a.standbyOrder = standbyNumber++;\r\n            a.standbyDays = Artists.appendToday(a.standbyDays);\r\n          }\r\n        }\r\n      });\r\n\r\n      // Apply the changes.\r\n      Artists.setAll(eligibleArtists);\r\n    });\r\n  }\r\n})((typeof window !== 'undefined') ? window : exports);\r\n","/* globals Artists, Elements, Filter, Promise */\r\n\r\n(function(scope) {\r\n\r\n  // Interface.\r\n  scope.Modal = {\r\n    addArtist: addArtist,\r\n    alert: showAlert,\r\n    batchSignOut: batchSignOut,\r\n    bulkArtistRoom: bulkArtistRoom,\r\n    confirm: showConfirm,\r\n    confirmConfirm: confirmConfirm,\r\n    editArtist: editArtist,\r\n    editArtistRaw: editArtistRaw,\r\n    prompt: showPrompt,\r\n    promptConfirm: promptConfirm,\r\n    resetDatabase: resetDatabase,\r\n    restoreDatabase: restoreDatabase,\r\n    runLottery: runLottery,\r\n    seedDatabase: seedDatabase,\r\n    setRawArtistId: setRawArtistId,\r\n    showCheckedOutArtists: showCheckedOutArtists,\r\n    showYesNoCancel: showYesNoCancel\r\n  };\r\n\r\n  // Private vars.\r\n  var _promptConfirm = [];\r\n  var _rapidEntry = false;\r\n\r\n  // Register a modal response handler.\r\n  function registerConfirm(handler) {\r\n    _promptConfirm.push(handler);\r\n  }\r\n\r\n  // Execute confirm dialog confirmation events.\r\n  function confirmConfirm(value) {\r\n    if (_promptConfirm.length > 0) {\r\n      _promptConfirm.pop()(value);\r\n    }\r\n  }\r\n\r\n  // Execute prompt confirmation events.\r\n  function promptConfirm() {\r\n    if (_promptConfirm.length > 0) {\r\n      _promptConfirm.pop()($('#prompt-dialog input').val());\r\n    }\r\n  }\r\n\r\n  // Populate the Artist modal with data from the model.\r\n  function mapArtistData(artistData) {\r\n    $('#artist-detail .artist-symbols').html(Elements.buildSymbols(artistData));\r\n    $('#artist-id').text(artistData.id || '0');\r\n    $('#artist-name').val(artistData.name || '');\r\n    $('#artist-badge').val(artistData.badgeNumber || '');\r\n    $('#artist-table').val(artistData.tableNumber || '');\r\n    $('#artist-room').val(artistData.roomNumber || '');\r\n    $('#artist-phone').val(artistData.phone || '');\r\n    $('#artist-remarks').val(artistData.remarks || '');\r\n    $('#artist-lottery-eligible').prop('checked', artistData.lotteryEligible || false);\r\n    $('#artist-lottery-guaranteed').prop('checked', artistData.lotteryGuaranteed || false);\r\n    $('#artist-seated-last').text(artistData.seatedLast ?\r\n      moment(artistData.seatedLast).calendar() : 'Never');\r\n    $('#artist-seated-days').text(artistData.seatedDays || 'Never');\r\n    $('#artist-standby-days').text(artistData.standbyDays || 'Never');\r\n  }\r\n\r\n  // Configure visibility on the artist detail modal.\r\n  function configureArtistDetail(isAddingArtist) {\r\n    isAddingArtist = !!isAddingArtist;\r\n    $('#artist-table').prop('disabled', isAddingArtist);\r\n    $('#artist-room').prop('disabled', isAddingArtist);\r\n    if (isAddingArtist) {\r\n      $('.artist-add-only').show();\r\n      $('.artist-edit-only').hide();\r\n    } else {\r\n      $('.artist-add-only').hide();\r\n      $('.artist-edit-only').show();\r\n    }\r\n  }\r\n\r\n  // Show the Artist modal with empty fields.\r\n  function addArtist(rapidEntry, doNotOpenModal) {\r\n    _rapidEntry = !!rapidEntry;\r\n    mapArtistData({\r\n      lotteryEligible: true\r\n    });\r\n    configureArtistDetail(true);\r\n    $('#artist-detail-mode').text('New Artist ');\r\n    if (!doNotOpenModal) {\r\n      $('#artist-detail').modal();\r\n    }\r\n  }\r\n\r\n  function batchSignOut() {\r\n    $('#batch-sign-out').modal();\r\n  }\r\n\r\n  // Show the Rapid Room Entry modal.\r\n  function bulkArtistRoom() {\r\n    Artists.getAll().then(function(artists) {\r\n      var container = $('<div/>');\r\n\r\n      // Filter out artists who are not already seated.\r\n      artists = Filter.seatedInOrder(artists);\r\n\r\n      // Generate HTML elements for seated artists.\r\n      artists.forEach(function(a) {\r\n        var nameField = $('<p/>')\r\n          .addClass('form-control-static')\r\n          .text(a.name);\r\n\r\n        var tableField = $('<p/>')\r\n          .addClass('form-control-static')\r\n          .text(a.tableNumber);\r\n\r\n        var inputBox = $('<input/>')\r\n          .addClass('form-control')\r\n          .attr('type', 'text')\r\n          .attr('id', 'bulk-artist-room-number-' + a.id)\r\n          .attr('value', a.roomNumber)\r\n          .attr('data-artist-id', a.id);\r\n\r\n        container.append(\r\n          $('<tr/>').append($('<td/>').append(nameField))\r\n            .append($('<td/>').append(tableField))\r\n            .append($('<td/>').append(inputBox)));\r\n      });\r\n\r\n      // Apply HTML and events.\r\n      $('#bulk-artist-room-table').html(container.html());\r\n      $('#bulk-artist-room-table input[type=text]').last().keydown(function(e) {\r\n        if (e.which === 13) {\r\n          e.preventDefault();\r\n          scope.setTimeout(function() {\r\n            $('[data-save=rooms]').focus();\r\n          }, 10);\r\n        }\r\n      });\r\n\r\n      // Show modal.\r\n      $('#bulk-artist-room').modal();\r\n\r\n      // Dynamically add SlimScroll bar to the modal (it can't be added on load)\r\n      $('#bulk-artist-room .room-content').each(function() {\r\n        var div = $(this);\r\n        if (!div.hasClass('scroll-added')) {\r\n          div.addClass('scroll-added');\r\n          div.slimScroll({\r\n            height: '100%'\r\n          });\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  // Show the Artist modal with fields from an existing artist.\r\n  function editArtist(id) {\r\n    Artists.get(id).then(function(artistData) {\r\n      mapArtistData(artistData);\r\n      $('#artist-detail-mode').text((artistData.name || 'Edit Artist') + ' ');\r\n      configureArtistDetail(false);\r\n      $('#artist-detail').modal();\r\n    });\r\n  }\r\n\r\n  // Show the Raw Edit modal.\r\n  function editArtistRaw() {\r\n    $('#raw-editor').modal();\r\n  }\r\n\r\n  // Show the Reset Database confirmation modal.\r\n  function resetDatabase() {\r\n    $('#reset-dialog').modal();\r\n  }\r\n\r\n  // Show the Restore Database modal.\r\n  function restoreDatabase() {\r\n    $('#import-dialog-file').replaceWith($('#import-dialog-file').clone());\r\n    $('#import-dialog').modal();\r\n  }\r\n\r\n  // Show the Run Lottery modal.\r\n  function runLottery() {\r\n    // Safeguard against wiping out the standby/checkin list.\r\n    Artists.getAll().then(function(artists) {\r\n      if (artists.some(function(a) {\r\n          return !!a.tableNumber;\r\n        })) {\r\n        showAlert('Lottery can\\'t be run. Artists are signed in yet.');\r\n      } else {\r\n        $('#run-lottery').modal();\r\n      }\r\n    });\r\n  }\r\n\r\n  // Show the Seed Database modal.\r\n  function seedDatabase() {\r\n    $('#generate-dialog').modal();\r\n  }\r\n\r\n  // Fill in the raw artist data text area.\r\n  function setRawArtistId(selectedId) {\r\n    var editor = $('[data-edit-raw=artist]');\r\n    if (selectedId) {\r\n      Artists.get(selectedId).then(function(artist) {\r\n        if (artist) {\r\n          delete artist.id;\r\n          editor.val(JSON.stringify(artist, null, 2));\r\n        } else {\r\n          editor.val('');\r\n        }\r\n      });\r\n    } else {\r\n      editor.val('');\r\n    }\r\n  }\r\n\r\n  // Show the alert modal.\r\n  function showAlert(message, caption) {\r\n    return new Promise(function(resolve, reject) {\r\n      if (message) {\r\n        $('#alert-title').text(caption || 'Notice');\r\n        $('#alert-body').text(message);\r\n        $('#alert-dialog').modal({\r\n          backdrop: 'static'\r\n        });\r\n        registerConfirm(resolve);\r\n      } else {\r\n        reject();\r\n      }\r\n    });\r\n  }\r\n\r\n  // Show checked out artists modal.\r\n  function showCheckedOutArtists() {\r\n    Artists.getAll().then(function(artists) {\r\n      var names = Filter.checkedOutToday(artists)\r\n        .map(function(a) { return a.name; });\r\n      names.sort();\r\n      var elements = names.map(function(a) {\r\n        return $('<div/>').text(a);\r\n      });\r\n      $('#checked-out-artists-body').html(elements);\r\n      $('#checked-out-artists').modal();\r\n    });\r\n  }\r\n\r\n  // Show the confirm modal.\r\n  function showConfirm(message, caption) {\r\n    return new Promise(function(resolve, reject) {\r\n      if (message) {\r\n        $('#confirm-title').text(caption || 'Confirmation Needed');\r\n        $('#confirm-body').text(message);\r\n        $('#confirm-dialog').modal({\r\n          backdrop: 'static'\r\n        });\r\n        registerConfirm(function(value) {\r\n          if (value === true) {\r\n            resolve(value);\r\n          } else {\r\n            reject();\r\n          }\r\n        });\r\n      } else {\r\n        reject();\r\n      }\r\n    });\r\n  }\r\n\r\n  // Show the prompt modal.\r\n  function showPrompt(message, caption) {\r\n    return new Promise(function(resolve, reject) {\r\n      if (message) {\r\n        $('#prompt-dialog input').val('');\r\n        $('#prompt-title').text(caption || 'Input Needed');\r\n        $('#prompt-body').text(message);\r\n        $('#prompt-dialog').modal({\r\n          backdrop: 'static'\r\n        });\r\n        registerConfirm(function(value) {\r\n          if (value === null || value === (void 0)) {\r\n            reject();\r\n          } else {\r\n            resolve(value);\r\n          }\r\n        });\r\n      } else {\r\n        reject();\r\n      }\r\n    });\r\n  }\r\n\r\n  // Show the yes/no/cancel modal.\r\n  function showYesNoCancel(message, caption) {\r\n    return new Promise(function(resolve, reject) {\r\n      if (message) {\r\n        $('#yes-no-cancel-title').text(caption || 'Confirmation Needed');\r\n        $('#yes-no-cancel-body').text(message);\r\n        $('#yes-no-cancel-dialog').modal({\r\n          backdrop: 'static'\r\n        });\r\n        registerConfirm(function(value) {\r\n          if (value === true || value === false) {\r\n            resolve(value);\r\n          } else {\r\n            reject();\r\n          }\r\n        });\r\n      } else {\r\n        reject();\r\n      }\r\n    });\r\n  }\r\n\r\n  // Initialize modal actions.\r\n  $(function() {\r\n\r\n    function getArtistFormId() {\r\n      return Number($('#artist-id').text());\r\n    }\r\n\r\n    function saveEditedArtist() {\r\n      var artistData = {};\r\n      artistData.id = getArtistFormId();\r\n      artistData.name = $('#artist-name').val();\r\n      artistData.badgeNumber = $('#artist-badge').val();\r\n      artistData.tableNumber = $('#artist-table').val();\r\n      artistData.roomNumber = $('#artist-room').val();\r\n      artistData.phone = $('#artist-phone').val();\r\n      artistData.remarks = $('#artist-remarks').val();\r\n      artistData.lotteryEligible = $('#artist-lottery-eligible').prop('checked');\r\n      artistData.lotteryGuaranteed = $('#artist-lottery-guaranteed').prop('checked');\r\n      if (artistData.tableNumber) {\r\n        artistData.lotteryOrder = 0;\r\n        artistData.standbyOrder = 0;\r\n      }\r\n      return Artists.set(artistData);\r\n    }\r\n\r\n    function saveEditedRooms() {\r\n      var artistRooms = [];\r\n\r\n      $('#bulk-artist-room-table input[type=text]').each(function() {\r\n        var inputElement = $(this);\r\n        var artistId = inputElement.attr('data-artist-id');\r\n        if (artistId) {\r\n          artistRooms.push({\r\n            id: artistId,\r\n            roomNumber: inputElement.val()\r\n          });\r\n        }\r\n      });\r\n\r\n      Artists.setAll(artistRooms);\r\n    }\r\n\r\n    function toggleArtistModal() {\r\n      $('#artist-detail').modal('toggle');\r\n    }\r\n\r\n    $('#artist-detail input[type=text]').last().keydown(function(e) {\r\n      if (e.which === 13) {\r\n        e.preventDefault();\r\n        if (!_rapidEntry) {\r\n          $('[data-save=artist]:visible').trigger('click');\r\n        } else {\r\n          saveEditedArtist();\r\n          addArtist(_rapidEntry, true);\r\n          scope.setTimeout(function() {\r\n            $('#artist-detail input').first().focus();\r\n          }, 10);\r\n        }\r\n      }\r\n    });\r\n\r\n    $('[data-delete=artist]').click(function() {\r\n      showConfirm(\r\n        'Really delete this artist?',\r\n        'Delete Artist Confirmation')\r\n        .then(function(confirmed) {\r\n          if (confirmed) {\r\n            Artists.delete(getArtistFormId());\r\n            toggleArtistModal();\r\n          }\r\n        });\r\n    });\r\n\r\n    $('[data-save=artist]').click(function(e) {\r\n      if ($('#artist-name').val().trim()) {\r\n        saveEditedArtist();\r\n        toggleArtistModal();\r\n      } else {\r\n        showAlert(\r\n          'A name is required for this artist.',\r\n          'Save Artist Failed');\r\n        e.preventDefault();\r\n      }\r\n    });\r\n\r\n    $('[data-save=rooms]').click(function() {\r\n      saveEditedRooms();\r\n    });\r\n\r\n    $('[data-standby=artist]').click(function() {\r\n      var performAction = function(artist) {\r\n        Artists.setStandby(artistId).then(function() {\r\n          Artists.getAll().then(function(artists) {\r\n            var index = Filter.standbyInOrder(artists).length;\r\n            showAlert(\r\n              'The artist is #' + index + ' in standby.',\r\n              'Add ' + artist.name + ' to Standby List'\r\n            ).then(function() {\r\n              toggleArtistModal();\r\n            });\r\n          });\r\n        });\r\n      };\r\n\r\n      var artistId = getArtistFormId();\r\n      Artists.get(artistId).then(function(artist) {\r\n        var caption = 'Add ' + artist.name + ' to Standby List';\r\n        if (artist.standbyOrder) {\r\n          showConfirm(\r\n            'This artist is already on standby. Performing this action will move them to the bottom of the list.',\r\n            caption)\r\n            .then(function(confirmed) {\r\n              if (confirmed) {\r\n                performAction(artist);\r\n              }\r\n            });\r\n        } else {\r\n          performAction(artist);\r\n        }\r\n      });\r\n    });\r\n\r\n    $('[data-signin=artist]').click(function() {\r\n      Artists.get(getArtistFormId()).then(function(artist) {\r\n        showPrompt(\r\n          'Enter a table number.',\r\n          'Sign In for ' + artist.name)\r\n          .then(function(seat) {\r\n            if (seat) {\r\n              Artists.setSeated(getArtistFormId(), seat);\r\n            }\r\n            toggleArtistModal();\r\n          });\r\n      });\r\n    });\r\n\r\n    $('[data-signout=artist]').click(function() {\r\n      Artists.get(getArtistFormId()).then(function(artist) {\r\n        var caption = 'Signing out ' + artist.name;\r\n        if (artist.tableNumber || artist.standbyOrder || artist.lotteryOrder) {\r\n          showYesNoCancel(\r\n            'Would this artist like to be included in tomorrow\\'s lottery?',\r\n            caption)\r\n            .then(function(eligible) {\r\n              Artists.setSignedOut(getArtistFormId(), !!eligible);\r\n              toggleArtistModal();\r\n            });\r\n        } else {\r\n          showAlert(\r\n            'This artist is already signed out.',\r\n            caption\r\n          ).then(toggleArtistModal);\r\n        }\r\n      });\r\n    });\r\n\r\n    $('[data-select-raw=artist]').change(function() {\r\n      var selectOption = $(this).find(':selected');\r\n      var selectedId = selectOption.attr('value');\r\n      setRawArtistId(selectedId);\r\n    });\r\n\r\n    $('[data-prompt-confirm]').click(function() {\r\n      promptConfirm();\r\n    });\r\n\r\n    $('[data-confirm-confirm]').click(function() {\r\n      confirmConfirm(true);\r\n    });\r\n\r\n    $('[data-confirm-deny]').click(function() {\r\n      confirmConfirm(false);\r\n    });\r\n\r\n    $('[data-confirm-cancel]').click(function() {\r\n      confirmConfirm(null);\r\n    });\r\n\r\n    $('#prompt-dialog input').keydown(function(e) {\r\n      if (e.which === 13) {\r\n        e.preventDefault();\r\n        $('[data-prompt-confirm]').trigger('click');\r\n      }\r\n    });\r\n  });\r\n})(window);\r\n","/* globals Artists, Elements, Filter, Modal */\r\n\r\n(function(scope) {\r\n  scope.Names = {\r\n    populate: populate\r\n  };\r\n\r\n  // Populate columns in all places in the app that contain artist lists.\r\n  function populate() {\r\n    Artists.getAll().then(function(artistData) {\r\n      var allListByName = Filter.sorted(artistData);\r\n      var standbyList = Filter.standbyInOrder(artistData);\r\n      var seatedList = Filter.seated(artistData);\r\n      var lotteryList = Filter.lotteryInOrder(artistData);\r\n      var lotteryListByName = Filter.lottery(artistData);\r\n      var checkedOutList = Filter.sorted(Filter.checkedOutToday(artistData));\r\n\r\n      buildNames($('.artist-names'), allListByName, {\r\n        withSymbols: true\r\n      });\r\n      buildNames($('.lottery-names'), lotteryList, {\r\n        withOrder: true\r\n      });\r\n      buildNames($('.standby-names'), standbyList, {\r\n        withOrder: true\r\n      });\r\n      buildNames($('.seated-names'), seatedList);\r\n\r\n      buildNames($('.lottery-sorted-names'), lotteryListByName, {\r\n        disableClick: true\r\n      });\r\n      buildNames($('.standby-sorted-names'), standbyList, {\r\n        disableClick: true\r\n      });\r\n      buildNames($('.seated-sorted-names'), seatedList, {\r\n        disableClick: true\r\n      });\r\n      buildNames($('.checkedout-sorted-names'), checkedOutList, {\r\n        disableClick: true\r\n      });\r\n\r\n      buildNameOptions($('[data-select-raw=artist]'), allListByName);\r\n\r\n      $('.count-artists').text(artistData.length);\r\n      $('.count-lottery').text(lotteryList.length);\r\n      $('.count-standby').text(standbyList.length);\r\n      $('.count-seated').text(seatedList.length);\r\n      $('.count-checkedout').text(checkedOutList.length);\r\n    });\r\n  }\r\n\r\n  // Build a name list for a Select element.\r\n  function buildNameOptions(container, nameData) {\r\n    var tempContainer = $('<div/>');\r\n    tempContainer.append($('<option/>')\r\n      .text('(select one...)'));\r\n\r\n    nameData.forEach(function(artist) {\r\n      tempContainer.append($('<option/>')\r\n        .attr('value', artist.id)\r\n        .text(artist.name)\r\n      );\r\n    });\r\n\r\n    container.html(tempContainer.html());\r\n  }\r\n\r\n  // Build a name list for use in the DOM.\r\n  function buildNames(container, nameData, options) {\r\n    options = Object.assign({\r\n      disableClick: false,\r\n      withSymbols: false,\r\n      withOrder: false\r\n    }, options);\r\n\r\n    container.empty();\r\n\r\n    nameData.forEach(function(artist, index) {\r\n      var nameElement = $('<a/>')\r\n        .addClass('line')\r\n        .text(artist.name + ' ');\r\n\r\n      if (options.withOrder) {\r\n        nameElement.prepend(Elements.buildSpan('artist-order')\r\n          .text('' + (index + 1) + '.'))\r\n          .attr('title', 'List Order');\r\n      }\r\n\r\n      if (artist.tableNumber) {\r\n        var tableElement = Elements.buildSpan('artist-seat');\r\n        tableElement.text('#' + artist.tableNumber)\r\n          .attr('title', 'Table Number');\r\n        nameElement.append(tableElement);\r\n      }\r\n\r\n      if (options.withSymbols) {\r\n        var symbolElement = Elements.buildSymbols(artist);\r\n        if (symbolElement.html().length > 0) {\r\n          symbolElement.addClass('faded');\r\n          nameElement.append(symbolElement);\r\n        }\r\n      }\r\n\r\n      container.append(nameElement);\r\n\r\n      if (!options.disableClick) {\r\n        nameElement\r\n          .attr('href', '#')\r\n          .click(createNameDetailClickHandler(artist.id));\r\n      }\r\n    });\r\n  }\r\n\r\n  // Create a click handler for opening name detail modals.\r\n  function createNameDetailClickHandler(id) {\r\n    return function() {\r\n      openNameDetail(id);\r\n    };\r\n  }\r\n\r\n  // Show name detail modal.\r\n  function openNameDetail(id) {\r\n    Modal.editArtist(id);\r\n  }\r\n})(window);\r\n","/* globals Database */\r\n\r\n(function(scope) {\r\n\r\n  // Interface.\r\n  scope.Scheduler = {\r\n    onArtistChange: onArtistChange,\r\n  };\r\n\r\n  // Handlers for when artist data changes.\r\n  var artistChangeEvents = [];\r\n  var artistTableVersion = -1;\r\n  var isDatabaseBusy = false;\r\n\r\n  // Initialize the timer event on load.\r\n  $(function() {\r\n    scope.setInterval(onTick, 500);\r\n  });\r\n\r\n  // Call all functions in an array.\r\n  function invokeAll(events) {\r\n    events.forEach(function(e) {\r\n      e();\r\n    });\r\n  }\r\n\r\n  // Schedule an event to run every time artist data changes.\r\n  function onArtistChange(eventFunction) {\r\n    artistChangeEvents.push(eventFunction);\r\n  }\r\n\r\n  // Main timer event.\r\n  function onTick() {\r\n    if (!isDatabaseBusy) {\r\n      Database.getTableVersion('artists').then(function(versions) {\r\n        if (!versions) {\r\n          versions = {\r\n            id: 1\r\n          };\r\n          Database.open().tableVersions.put(versions);\r\n        }\r\n        if (versions.artists !== artistTableVersion) {\r\n          console.log('Update requested. New version ' + versions.artists);\r\n          artistTableVersion = versions.artists;\r\n          invokeAll(artistChangeEvents);\r\n        }\r\n        isDatabaseBusy = false;\r\n      });\r\n      isDatabaseBusy = true;\r\n    }\r\n  }\r\n})(window);\r\n","(function(scope) {\r\n  scope.Screen = {\r\n    reposition: reposition,\r\n    select: select\r\n  };\r\n\r\n  // Center the screen element horizontally. This isn't the most\r\n  // elegant solution...\r\n  function reposition() {\r\n    var width = $(scope).width();\r\n    var leftMargin = 0;\r\n    if (width > 960) {\r\n      var containerWidth = $('.screen:visible').width();\r\n      leftMargin = (width - containerWidth) / 2;\r\n    }\r\n    $('.screen').css('marginLeft', leftMargin);\r\n  }\r\n\r\n  // Select a screen by ID to show.\r\n  function select(screenId) {\r\n    // Hide other screens.\r\n    $('.screen[id!=\"' + screenId + '\"]').hide();\r\n\r\n    var desiredScreen = $('.screen#' + screenId);\r\n    if (desiredScreen.length > 0) {\r\n\r\n      // Hide the nav if the screen calls for it.\r\n      if (desiredScreen.hasClass('hide-nav')) {\r\n        $('nav').remove();\r\n        $('.screen').css('padding-top', 0);\r\n      }\r\n\r\n      // Show the desired screen.\r\n      desiredScreen.show();\r\n      reposition();\r\n\r\n      // Apply SlimScroll if it hasn't already been added.\r\n      var content = desiredScreen.find('.content');\r\n      if (!content.hasClass('scroll-added')) {\r\n        content.addClass('scroll-added');\r\n        content.slimScroll({\r\n          height: '100%',\r\n          size: '12px',\r\n          alwaysVisible: true\r\n        });\r\n      }\r\n    }\r\n  }\r\n})(window);\r\n","/* globals Artists, Database, FileTransfer, Generator, Lottery, Modal, Promise */\r\n\r\n(function(scope) {\r\n\r\n  // Interface.\r\n  scope.SystemActions = {\r\n    batchSignOut: batchSignOut,\r\n    databaseBackup: databaseBackup,\r\n    databaseRestore: databaseRestore,\r\n    exportCsv: exportCsv,\r\n    findArtistByBadge: findArtistByBadge,\r\n    findArtistByTable: findArtistByTable,\r\n    findCheckedOutArtists: findCheckedOutArtists,\r\n    newArtistRapidEntry: newArtistRapidEntry,\r\n    resetDatabase: resetDatabase,\r\n    runLottery: runLottery,\r\n    saveArtistRaw: saveArtistRaw,\r\n    seedDatabase: seedDatabase\r\n  };\r\n\r\n  // Make the user type in a word. Returns true if they actually did it.\r\n  function confirmAction(actionName, caption) {\r\n    return Modal.prompt(\r\n      'Confirm by typing \\'' + actionName + '\\' into the box below.',\r\n      caption || 'Confirmation')\r\n      .then(function(value) {\r\n        return new Promise(function(resolve, reject) {\r\n          if (value === actionName) {\r\n            resolve(value);\r\n          } else {\r\n            reject();\r\n          }\r\n        });\r\n      });\r\n  }\r\n\r\n  // Sign out all artists. Mark those who have not signed out ineligible.\r\n  // Artists still on standby are marked eligible for lottery.\r\n  function batchSignOut() {\r\n    return confirmAction(\r\n      'close',\r\n      'Close Out Day')\r\n      .then(function() {\r\n        return Artists.getAll().then(function(artists) {\r\n          return Database.transaction(function() {\r\n            return Dexie.Promise.all(artists.map(function(a) {\r\n              if (a.tableNumber) {\r\n                return Artists.setSignedOut(a.id, false);\r\n              } else if (a.standbyOrder || a.lotteryOrder) {\r\n                return Artists.setSignedOut(a.id, true);\r\n              }\r\n            }));\r\n          });\r\n        });\r\n      });\r\n  }\r\n\r\n  // Export everything as a CSV file.\r\n  function exportCsv() {\r\n    return Modal.showYesNoCancel(\r\n      'Will you be exporting this CSV for use in Microsoft Excel?',\r\n      'Export CSV')\r\n      .then(function(excelMode) {\r\n        return Artists.getAll().then(function(users) {\r\n          var csv = '';\r\n\r\n          // build CSV columns\r\n          var csvColumns = [\r\n            'name',\r\n            'badgeNumber',\r\n            'tableNumber',\r\n            'roomNumber',\r\n            'phone',\r\n            'remarks',\r\n            'seatedLast',\r\n            'seatedDays',\r\n            'standbyDays'\r\n          ];\r\n          csv += csvColumns.join(',') + '\\r\\n';\r\n\r\n          // build CSV rows\r\n          users.forEach(function(user) {\r\n            var csvRow = [];\r\n            csvColumns.forEach(function(column) {\r\n              var columnValue = user[column];\r\n              if (columnValue === false) {\r\n                columnValue = 'N';\r\n              } else if (columnValue === true) {\r\n                columnValue = 'Y';\r\n              } else if (columnValue !== 0 && !columnValue) {\r\n                columnValue = null;\r\n              } else if (Array.isArray(columnValue)) {\r\n                columnValue = columnValue.join('|');\r\n              } else {\r\n                columnValue = '' + columnValue;\r\n              }\r\n              if (columnValue !== null) {\r\n                columnValue = '\"' + columnValue.replace(/\"/g, '\"\"') + '\"';\r\n              } else {\r\n                columnValue = '';\r\n              }\r\n              if (excelMode && columnValue.length > 0 && columnValue.indexOf(',') < 0) {\r\n                columnValue = '=' + columnValue;\r\n              }\r\n              csvRow.push(columnValue);\r\n            });\r\n            csv += csvRow.join(',') + '\\r\\n';\r\n          });\r\n\r\n          // send file to user\r\n          FileTransfer.download('Artists.csv', csv);\r\n        });\r\n      }\r\n    );\r\n  }\r\n\r\n  // Find an artist. Pass in a function that returns TRUE for criteria.\r\n  function findArtist(predicate) {\r\n    return Artists.getAll().then(function(artists) {\r\n      var filteredArtists = artists.filter(predicate);\r\n      if (filteredArtists.length > 0) {\r\n        Modal.editArtist(filteredArtists[0].id);\r\n      } else {\r\n        Modal.alert(\r\n          'No matching artists were found.',\r\n          'Search Results'\r\n        );\r\n      }\r\n    });\r\n  }\r\n\r\n  // Find an artist by field===value\r\n  function findArtistBy(fieldName, value) {\r\n    var valueString = '' + value;\r\n    return findArtist(function(a) {\r\n      return a[fieldName] &&\r\n        ('' + a[fieldName]) === valueString;\r\n    });\r\n  }\r\n\r\n  // Find an artist by badge number.\r\n  function findArtistByBadge() {\r\n    return Modal.prompt(\r\n      'Enter badge number.',\r\n      'Find Artist by Badge Number')\r\n      .then(function(badgeNumber) {\r\n        if (badgeNumber) {\r\n          findArtistBy('badgeNumber', badgeNumber);\r\n        }\r\n      });\r\n  }\r\n\r\n  // Find an artist by table number.\r\n  function findArtistByTable() {\r\n    return Modal.prompt(\r\n      'Enter table number.',\r\n      'Find Artist by Table Number')\r\n      .then(function(tableNumber) {\r\n        if (tableNumber) {\r\n          findArtistBy('tableNumber', tableNumber);\r\n        }\r\n      });\r\n  }\r\n\r\n  // Find all checked out artists for today.\r\n  function findCheckedOutArtists() {\r\n    Modal.showCheckedOutArtists();\r\n  }\r\n\r\n  // Create new artists with rapid entry capability.\r\n  function newArtistRapidEntry() {\r\n    Modal.addArtist(true);\r\n  }\r\n\r\n  // Clear out all artists.\r\n  function resetDatabase() {\r\n    return confirmAction(\r\n      'reset',\r\n      'Wipe Everything')\r\n      .then(Artists.clear);\r\n  }\r\n\r\n  // Run the lottery for a given number of slots.\r\n  function runLottery() {\r\n    return Modal.prompt(\r\n      'How many seats?',\r\n      'Run Lottery')\r\n      .then(function(seats) {\r\n        if (seats) {\r\n          var slotsAvailable = +seats;\r\n          if (slotsAvailable > 0) {\r\n            Lottery.run(slotsAvailable);\r\n          }\r\n        }\r\n      });\r\n  }\r\n\r\n  // Save raw artist data.\r\n  function saveArtistRaw() {\r\n    try {\r\n      var artistId = +$('[data-select-raw]').find(':selected').attr('value');\r\n      if (artistId) {\r\n        var artist = JSON.parse($('[data-edit-raw]').val());\r\n        artist.id = artistId;\r\n        Artists.set(artist).then(function() {\r\n          Modal.alert('The artist was saved successfully.');\r\n        });\r\n      }\r\n    } catch (e) {\r\n      Modal.alert('The artist could not be saved:\\n' + e.message);\r\n    }\r\n  }\r\n\r\n  // Fill the database with mock data.\r\n  function seedDatabase() {\r\n    return confirmAction(\r\n      'generate',\r\n      'Generate Test Data')\r\n      .then(function() {\r\n        Artists.clear().then(function() {\r\n          var artists = [];\r\n          for (var i = 0; i < 200; i++) {\r\n            artists.push(Generator.getRandomArtist());\r\n          }\r\n          return Artists.setAll(artists);\r\n        });\r\n      });\r\n  }\r\n\r\n  // Backup database to JSON\r\n  function databaseBackup() {\r\n    return Database.backup().then(function(data) {\r\n      var fileName = 'backup-' + moment().format('x') + '.json';\r\n      return FileTransfer.download(fileName, JSON.stringify(data));\r\n    });\r\n  }\r\n\r\n  // Restore database from JSON\r\n  function databaseRestore() {\r\n    var files = $('#import-dialog-file')[0].files;\r\n    if (files[0]) {\r\n      return FileTransfer.upload(files[0]).then(\r\n        function(fileData) {\r\n          var jsonData;\r\n          try {\r\n            jsonData = JSON.parse(fileData);\r\n          } catch (e) {\r\n            return Promise.reject(e);\r\n          }\r\n          return Promise.resolve(jsonData);\r\n        }\r\n      ).then(Database.restore).then(\r\n        Modal.alert(\r\n          'The database was restored successfully.',\r\n          'Database Restore')\r\n      )\r\n        .catch(function(e) {\r\n          Modal.alert(\r\n            'There was a problem restoring the database:\\n' + e,\r\n            'Database Restore Failed');\r\n        });\r\n    }\r\n    return Promise.reject();\r\n  }\r\n\r\n})(window);\r\n","/* globals exports */\r\n\r\n(function(scope) {\r\n  // Interface.\r\n  scope.Time = {\r\n    getTodayString: getTodayString\r\n  };\r\n\r\n  // Get today's day string.\r\n  function getTodayString() {\r\n    return moment().format('dddd');\r\n  }\r\n})((typeof window !== 'undefined') ? window : exports);\r\n","/* globals Modal, Names, Scheduler, Screen, SystemActions */\r\n\r\n$(function() {\r\n  function InitializeFirstScreen() {\r\n    var screenId = window.location.hash.substring(1);\r\n    if (!screenId || screenId.length === 0) {\r\n      screenId = 'main';\r\n    }\r\n    Screen.select(screenId);\r\n  }\r\n\r\n  // Initialize the window handler which repositions content on resize.\r\n  function InitializeResizeHandler() {\r\n    $(window).resize(Screen.reposition);\r\n  }\r\n\r\n  // Initialize all links with the \"data-modal\" attribute so they pop up when\r\n  // activated.\r\n  function InitializeModalNavigation() {\r\n    $('a[data-modal]').each(function(i, e) {\r\n      var linkElement = $(e);\r\n      var modalId = linkElement.attr('data-modal');\r\n      linkElement\r\n        .click(function() {\r\n          Modal[modalId]();\r\n        });\r\n      if (!linkElement.attr('href')) {\r\n        linkElement.attr('href', '#');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Initialize all links with the \"data-screen\" attribute so they switch\r\n  // screens when clicked.\r\n  function InitializeScreenNavigation() {\r\n    $('a[data-screen]').each(function(i, e) {\r\n      var linkElement = $(e);\r\n      var screenId = linkElement.attr('data-screen');\r\n      linkElement\r\n        .attr('href', '#' + screenId)\r\n        .click(function() {\r\n          Screen.select(screenId);\r\n        });\r\n    });\r\n  }\r\n\r\n  // Initialize links with system actions.\r\n  function InitializeSystemActions() {\r\n    $('[data-system-action]').each(function(i, e) {\r\n      var linkElement = $(e);\r\n      var action = linkElement.attr('data-system-action');\r\n      linkElement\r\n        .click(function() {\r\n          SystemActions[action]();\r\n        });\r\n      if (!linkElement.attr('href')) {\r\n        linkElement.attr('href', '#');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Initialization.\r\n  InitializeModalNavigation();\r\n  InitializeScreenNavigation();\r\n  InitializeFirstScreen();\r\n  InitializeResizeHandler();\r\n  InitializeSystemActions();\r\n\r\n  // Hook events.\r\n  Scheduler.onArtistChange(Names.populate);\r\n\r\n  // This fixes layered modals. Courtesy of:\r\n  // http://gurde.com/stacked-bootstrap-modals/\r\n  $(function() {\r\n    $(document)\r\n      .on('show.bs.modal', '.modal', function() {\r\n        $(this).appendTo($('body'));\r\n      })\r\n      .on('shown.bs.modal', '.modal.in', function() {\r\n        setModalsAndBackdropsOrder();\r\n      })\r\n      .on('hidden.bs.modal', '.modal', function() {\r\n        setModalsAndBackdropsOrder();\r\n        if ($('.modal.in').length === 0) {\r\n          $('body').removeClass('modal-open');\r\n        }\r\n      });\r\n\r\n    function setModalsAndBackdropsOrder() {\r\n      $('body').addClass('modal-open');\r\n      var modalZIndex = $('.modal.in').length + 1050 + 1;\r\n      var backdropZIndex = modalZIndex - 1;\r\n      $('.modal-backdrop').addClass('hidden');\r\n      $('.modal.in:last').css('z-index', modalZIndex);\r\n      $('.modal-backdrop.in:last').css('z-index', backdropZIndex).removeClass('hidden');\r\n    }\r\n  });\r\n});\r\n","$(function() {\r\n  JoelPurra.PlusAsTab.setOptions({\r\n    key: 13\r\n  });\r\n\r\n  $(document).on('shown.bs.modal', '.modal', function() {\r\n    $(this).find('[autofocus]').focus();\r\n  });\r\n});\r\n"]}